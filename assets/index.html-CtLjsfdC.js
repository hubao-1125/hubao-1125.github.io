import{_ as a,c as n,a as p,o as l}from"./app-Dm747Kgg.js";const c={};function e(t,s){return l(),n("div",null,s[0]||(s[0]=[p(`<p>在Java中，类常量池、运行时常量池和字符串常量池是与常量存储相关的三个核心概念，它们在<strong>定义、位置、生命周期</strong>等方面既有联系又有区别，且与JDK版本演变密切相关。</p><h3 id="一、核心定义与基本概念" tabindex="-1"><a class="header-anchor" href="#一、核心定义与基本概念"><span>一、核心定义与基本概念</span></a></h3><h4 id="_1-类常量池-class-constant-pool" tabindex="-1"><a class="header-anchor" href="#_1-类常量池-class-constant-pool"><span>1. 类常量池（Class Constant Pool）</span></a></h4><ul><li><strong>本质</strong>：<strong>class文件的静态结构</strong>，是编译后保存在class文件中的“常量表”。</li><li><strong>生成时机</strong>：Java源文件编译为class文件时由编译器生成。</li><li><strong>存储内容</strong>： <ul><li>字面量（Literal）：字符串字面量（如<code>&quot;abc&quot;</code>）、基本类型常量（如<code>123</code>、<code>true</code>）。</li><li>符号引用（Symbolic Reference）：类和接口的全限定名、字段名和描述符、方法名和描述符。</li></ul></li><li><strong>作用</strong>：为类加载后的运行时常量池提供原始数据。</li></ul><h4 id="_2-运行时常量池-runtime-constant-pool" tabindex="-1"><a class="header-anchor" href="#_2-运行时常量池-runtime-constant-pool"><span>2. 运行时常量池（Runtime Constant Pool）</span></a></h4><ul><li><strong>本质</strong>：类常量池在<strong>运行时的内存体现</strong>，是方法区（Method Area）的一部分。</li><li><strong>生成时机</strong>：类加载的<strong>Linking阶段</strong>（解析环节），类常量池被加载到JVM内存中，形成运行时常量池。</li><li><strong>存储内容</strong>： <ul><li>类常量池的内容（字面量、符号引用）。</li><li>符号引用解析后的<strong>直接引用</strong>（方法/字段在内存中的实际地址）。</li><li>动态生成的常量（如<code>String.intern()</code>动态加入的字符串）。</li></ul></li><li><strong>特点</strong>：每个类对应一个独立的运行时常量池，随类的卸载而销毁。</li></ul><h4 id="_3-字符串常量池-string-constant-pool" tabindex="-1"><a class="header-anchor" href="#_3-字符串常量池-string-constant-pool"><span>3. 字符串常量池（String Constant Pool）</span></a></h4><ul><li><strong>本质</strong>：专门存储字符串常量的“内存池”，用于<strong>避免字符串重复创建</strong>，提高内存利用率。</li><li><strong>生成时机</strong>：JVM启动时创建，贯穿JVM生命周期。</li><li><strong>存储内容</strong>： <ul><li>JDK 6及之前：存储<strong>字符串对象</strong>（直接在永久代分配）。</li><li>JDK 7及之后：存储<strong>字符串对象的引用</strong>（引用指向堆中的字符串对象）。</li></ul></li><li><strong>核心机制</strong>：通过<code>String.intern()</code>方法，可将堆中的字符串对象“入池”（若池中有相同内容的字符串，则返回池中的引用；否则将对象引用加入池并返回）。</li></ul><h3 id="二、三者的关系-随jdk版本演变" tabindex="-1"><a class="header-anchor" href="#二、三者的关系-随jdk版本演变"><span>二、三者的关系（随JDK版本演变）</span></a></h3><h4 id="_1-jdk-6及之前的关系" tabindex="-1"><a class="header-anchor" href="#_1-jdk-6及之前的关系"><span>1. JDK 6及之前的关系</span></a></h4><ul><li><strong>方法区实现</strong>：永久代（PermGen）。</li><li><strong>包含关系</strong>： <ul><li>运行时常量池（属于方法区）包含字符串常量池。</li><li>字符串常量池存储的是<strong>字符串对象本身</strong>（而非引用）。</li><li>类常量池 →（加载后）→ 运行时常量池（包含字符串常量池）。</li></ul></li></ul><h4 id="_2-jdk-7及之后的关系" tabindex="-1"><a class="header-anchor" href="#_2-jdk-7及之后的关系"><span>2. JDK 7及之后的关系</span></a></h4><ul><li><strong>关键变化</strong>： <ul><li>字符串常量池从永久代<strong>移至堆内存</strong>。</li><li>运行时常量池仍属于方法区（JDK 8后为元空间Metaspace）。</li></ul></li><li><strong>包含关系调整</strong>： <ul><li>运行时常量池不再直接包含字符串常量池，两者在物理上分离。</li><li>运行时常量池中的字符串字面量，会指向堆中字符串常量池的引用。</li><li>类常量池 →（加载后）→ 运行时常量池（符号引用解析为直接引用，字符串字面量指向堆中的字符串常量池）。</li></ul></li><li><strong>JDK 8补充</strong>：方法区由永久代改为元空间（使用本地内存），运行时常量池移至元空间，但字符串常量池仍在堆中。</li></ul><h3 id="三、三者的核心区别" tabindex="-1"><a class="header-anchor" href="#三、三者的核心区别"><span>三、三者的核心区别</span></a></h3><table><thead><tr><th>维度</th><th>类常量池</th><th>运行时常量池</th><th>字符串常量池</th></tr></thead><tbody><tr><td><strong>物理位置</strong></td><td>class文件（磁盘）</td><td>JDK 6-7：永久代<br>JDK 8+：元空间（本地内存）</td><td>JDK 6：永久代<br>JDK 7+：堆内存</td></tr><tr><td><strong>生成时机</strong></td><td>编译时（javac）</td><td>类加载时（Linking阶段）</td><td>JVM启动时</td></tr><tr><td><strong>生命周期</strong></td><td>与class文件共存</td><td>与类的生命周期一致（类卸载时销毁）</td><td>与JVM生命周期一致（除非字符串被GC回收）</td></tr><tr><td><strong>存储内容</strong></td><td>字面量、符号引用</td><td>解析后的直接引用、字面量、动态常量</td><td>字符串对象（JDK 6）或字符串引用（JDK 7+）</td></tr><tr><td><strong>作用</strong></td><td>为运行时常量池提供静态数据</td><td>支撑类的运行时访问（如方法调用、字段访问）</td><td>字符串去重，减少内存占用</td></tr><tr><td><strong>唯一性</strong></td><td>每个class文件一个</td><td>每个类一个</td><td>JVM全局唯一（所有类共享）</td></tr></tbody></table><h3 id="四、典型示例与验证" tabindex="-1"><a class="header-anchor" href="#四、典型示例与验证"><span>四、典型示例与验证</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki material-theme-ocean vp-code"><code><span class="line"><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">class</span><span class="space"> </span><span style="color:#FFCB6B;">ConstantPoolDemo</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">static</span><span class="space"> </span><span style="color:#C792EA;">void</span><span class="space"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span class="space"> </span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">s1：字符串字面量，编译时加入类常量池，运行时指向字符串常量池中的引用</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">String</span><span class="space"> </span><span style="color:#BABED8;">s1</span><span class="space"> </span><span style="color:#89DDFF;">=</span><span class="space"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">s2：new创建的对象，直接在堆中分配，不指向字符串常量池</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">String</span><span class="space"> </span><span style="color:#BABED8;">s2</span><span class="space"> </span><span style="color:#89DDFF;">=</span><span class="space"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span class="space"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">abc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">s3：调用intern()，若&quot;abc&quot;在池中则返回池中的引用，否则将s2的引用加入池并返回</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">String</span><span class="space"> </span><span style="color:#BABED8;">s3</span><span class="space"> </span><span style="color:#89DDFF;">=</span><span class="space"> </span><span style="color:#BABED8;">s2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">intern</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">验证：s1和s3指向字符串常量池中的同一引用，s2指向堆中的新对象</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#BABED8;">System</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">s1</span><span class="space"> </span><span style="color:#89DDFF;">==</span><span class="space"> </span><span style="color:#BABED8;">s2</span><span style="color:#89DDFF;">);</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">false（s1在池，s2在堆）</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#BABED8;">System</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">s1</span><span class="space"> </span><span style="color:#89DDFF;">==</span><span class="space"> </span><span style="color:#BABED8;">s3</span><span style="color:#89DDFF;">);</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">true（s3入池后与s1引用相同）</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><ul><li><strong>类常量池</strong>是class文件的静态常量表，编译时生成；</li><li><strong>运行时常量池</strong>是类常量池的运行时体现，存储在方法区（元空间），随类加载/卸载；</li><li><strong>字符串常量池</strong>是专门的字符串去重池，JDK 7后移至堆，全局唯一，存储字符串引用或对象；</li><li>三者的关系随JDK版本演变，核心是JVM内存模型的优化（如永久代→元空间、字符串常量池移至堆）。</li></ul>`,19)]))}const r=a(c,[["render",e],["__file","index.html.vue"]]),i=JSON.parse(`{"path":"/doc/Java/JVM/%E5%88%86%E4%BB%A3%E5%88%86%E5%8C%BA/170959/","title":"类常量池、运行时常量池、字符串常量池有什么关系？有什么区别？","lang":"zh-CN","frontmatter":{"title":"类常量池、运行时常量池、字符串常量池有什么关系？有什么区别？","createTime":"2025/12/23 17:09:59","permalink":"/doc/Java/JVM/分代分区/170959/","copyright":{"author":{"name":"Hu Bao","url":"https://github.com/hubao-1125"}},"tags":["JVM","面试题"],"description":"在Java中，类常量池、运行时常量池和字符串常量池是与常量存储相关的三个核心概念，它们在定义、位置、生命周期等方面既有联系又有区别，且与JDK版本演变密切相关。 一、核心定义与基本概念 1. 类常量池（Class Constant Pool） 本质：class文件的静态结构，是编译后保存在class文件中的“常量表”。 生成时机：Java源文件编译为c...","head":[["meta",{"property":"og:url","content":"https://hubao-1125.github.io/doc/Java/JVM/%E5%88%86%E4%BB%A3%E5%88%86%E5%8C%BA/170959/"}],["meta",{"property":"og:site_name","content":"Hu bao's blog"}],["meta",{"property":"og:title","content":"类常量池、运行时常量池、字符串常量池有什么关系？有什么区别？"}],["meta",{"property":"og:description","content":"在Java中，类常量池、运行时常量池和字符串常量池是与常量存储相关的三个核心概念，它们在定义、位置、生命周期等方面既有联系又有区别，且与JDK版本演变密切相关。 一、核心定义与基本概念 1. 类常量池（Class Constant Pool） 本质：class文件的静态结构，是编译后保存在class文件中的“常量表”。 生成时机：Java源文件编译为c..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-23T09:23:42.000Z"}],["meta",{"property":"article:tag","content":"JVM"}],["meta",{"property":"article:tag","content":"面试题"}],["meta",{"property":"article:modified_time","content":"2025-12-23T09:23:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"类常量池、运行时常量池、字符串常量池有什么关系？有什么区别？\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-23T09:23:42.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":4.67,"words":1401},"git":{"updatedTime":1766481822000,"contributors":[{"name":"hubao-1125","username":"hubao-1125","email":"19473254+hubao-1125@users.noreply.github.com","commits":1,"avatar":"https://avatars.githubusercontent.com/hubao-1125?v=4","url":"https://github.com/hubao-1125"}]},"autoDesc":true,"filePathRelative":"doc/Java/JVM/分代分区/15.类常量池、运行时常量池、字符串常量池有什么关系？有什么区别？.md","categoryList":[{"id":"9a09b4","sort":10000,"name":"doc"},{"id":"8f1aa6","sort":10001,"name":"Java"},{"id":"000f90","sort":10002,"name":"JVM"},{"id":"2b6b47","sort":10003,"name":"分代分区"}]}`);export{r as comp,i as data};
