import{_ as a,c as p,a as n,o as c}from"./app-Dm747Kgg.js";const e={};function l(o,s){return c(),p("div",null,s[0]||(s[0]=[n(`<p>栈内存溢出是指JVM虚拟机栈（或本地方法栈）的内存使用超出其限制时抛出的异常，主要分为两种情况：<strong>StackOverflowError</strong> 和 <strong>OutOfMemoryError</strong>，其触发条件和场景不同。</p><h3 id="一、stackoverflowerror-栈溢出错误" tabindex="-1"><a class="header-anchor" href="#一、stackoverflowerror-栈溢出错误"><span>一、StackOverflowError（栈溢出错误）</span></a></h3><p>当<strong>单个线程的虚拟机栈深度超过其最大限制</strong>时抛出，是最常见的栈内存溢出类型。</p><h4 id="触发条件" tabindex="-1"><a class="header-anchor" href="#触发条件"><span>触发条件</span></a></h4><ol><li><p><strong>无限递归或递归层级过深</strong><br> 递归方法没有正确的终止条件，或递归深度超过虚拟机栈的最大容量。<br> 例如：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki material-theme-ocean vp-code"><code><span class="line"><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">class</span><span class="space"> </span><span style="color:#FFCB6B;">StackOverflowDemo</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">void</span><span class="space"> </span><span style="color:#82AAFF;">recursiveCall</span><span style="color:#89DDFF;">()</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#82AAFF;">recursiveCall</span><span style="color:#89DDFF;">();</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">无限递归，无终止条件</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">static</span><span class="space"> </span><span style="color:#C792EA;">void</span><span class="space"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span class="space"> </span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span class="space"> </span><span style="color:#82AAFF;">StackOverflowDemo</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">recursiveCall</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行后会抛出：<code>java.lang.StackOverflowError</code></p></li><li><p><strong>方法调用链过长</strong><br> 非递归的情况下，方法嵌套调用层级过深（如循环调用大量中间方法），导致栈帧数量超过限制。</p></li><li><p><strong>虚拟机栈大小设置过小</strong><br> 通过JVM参数<code>-Xss</code>设置了过小的栈内存（默认约1MB），即使正常的方法调用也可能触发溢出。<br> 例如：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki material-theme-ocean vp-code"><code><span class="line"><span style="color:#FFCB6B;">java</span><span class="space"> </span><span style="color:#C3E88D;">-Xss128k</span><span class="space"> </span><span style="color:#C3E88D;">StackOverflowDemo</span><span class="space"> </span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">#</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">设置栈大小为128KB，容易触发溢出</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="二、outofmemoryerror-内存不足错误" tabindex="-1"><a class="header-anchor" href="#二、outofmemoryerror-内存不足错误"><span>二、OutOfMemoryError（内存不足错误）</span></a></h3><p>当<strong>系统无法为新线程分配虚拟机栈内存</strong>时抛出，通常与<strong>线程数量过多</strong>有关。</p><h4 id="触发条件-1" tabindex="-1"><a class="header-anchor" href="#触发条件-1"><span>触发条件</span></a></h4><p>虚拟机栈是线程私有的，<strong>每个线程都会分配独立的栈内存</strong>。若创建大量线程，总栈内存之和超过系统可用内存（或JVM进程的内存限制），会导致内存不足。</p><p>例如：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki material-theme-ocean vp-code"><code><span class="line"><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">class</span><span class="space"> </span><span style="color:#FFCB6B;">OOMStackDemo</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C792EA;">public</span><span class="space"> </span><span style="color:#C792EA;">static</span><span class="space"> </span><span style="color:#C792EA;">void</span><span class="space"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span class="space"> </span><span style="color:#BABED8;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;font-style:italic;">while</span><span class="space"> </span><span style="color:#89DDFF;">(true)</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span class="space"> </span><span style="color:#82AAFF;">Thread</span><span style="color:#89DDFF;">(()</span><span class="space"> </span><span style="color:#C792EA;">-&gt;</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;font-style:italic;">try</span><span class="space"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#BABED8;">Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">Integer</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">MAX_VALUE</span><span style="color:#89DDFF;">);</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">//</span><span class="space"> </span><span style="color:#464B5D;font-style:italic;">线程保持存活</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}</span><span class="space"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span class="space"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">InterruptedException</span><span class="space"> </span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span class="space"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}).</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行后会抛出：<code>java.lang.OutOfMemoryError: unable to create new native thread</code></p><h3 id="三、本地方法栈的溢出-native-method-stack" tabindex="-1"><a class="header-anchor" href="#三、本地方法栈的溢出-native-method-stack"><span>三、本地方法栈的溢出（Native Method Stack）</span></a></h3><p>本地方法栈为Native方法服务，其溢出情况与虚拟机栈类似，但具体表现依赖于JVM实现：</p><ul><li>HotSpot虚拟机将本地方法栈与虚拟机栈合并，因此溢出异常与虚拟机栈一致。</li><li>其他虚拟机（如JRockit）可能单独实现本地方法栈，溢出时可能抛出特定异常。</li></ul><h3 id="四、如何避免栈内存溢出" tabindex="-1"><a class="header-anchor" href="#四、如何避免栈内存溢出"><span>四、如何避免栈内存溢出</span></a></h3><ol><li><strong>避免无限递归</strong>：确保递归方法有明确的终止条件，并控制递归深度。</li><li><strong>优化方法调用链</strong>：减少不必要的中间方法调用，避免过度嵌套。</li><li><strong>合理设置栈大小</strong>：根据业务需求调整<code>-Xss</code>参数（如递归深度大时适当增大）。</li><li><strong>控制线程数量</strong>：避免创建过多线程，优先使用线程池管理线程资源。</li></ol><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p>栈内存溢出的核心原因是<strong>栈深度超出限制</strong>（StackOverflowError）或<strong>线程过多导致总栈内存耗尽</strong>（OutOfMemoryError）。</p>`,19)]))}const r=a(e,[["render",l],["__file","index.html.vue"]]),i=JSON.parse(`{"path":"/doc/Java/JVM/%E5%88%86%E4%BB%A3%E5%88%86%E5%8C%BA/144938/","title":"什么情况下会发生栈内存溢出","lang":"zh-CN","frontmatter":{"title":"什么情况下会发生栈内存溢出","createTime":"2025/12/23 14:49:38","permalink":"/doc/Java/JVM/分代分区/144938/","copyright":{"author":{"name":"Hu Bao","url":"https://github.com/hubao-1125"}},"tags":["JVM","面试题"],"description":"栈内存溢出是指JVM虚拟机栈（或本地方法栈）的内存使用超出其限制时抛出的异常，主要分为两种情况：StackOverflowError 和 OutOfMemoryError，其触发条件和场景不同。 一、StackOverflowError（栈溢出错误） 当单个线程的虚拟机栈深度超过其最大限制时抛出，是最常见的栈内存溢出类型。 触发条件 无限递归或递归层级...","head":[["meta",{"property":"og:url","content":"https://hubao-1125.github.io/doc/Java/JVM/%E5%88%86%E4%BB%A3%E5%88%86%E5%8C%BA/144938/"}],["meta",{"property":"og:site_name","content":"Hu bao's blog"}],["meta",{"property":"og:title","content":"什么情况下会发生栈内存溢出"}],["meta",{"property":"og:description","content":"栈内存溢出是指JVM虚拟机栈（或本地方法栈）的内存使用超出其限制时抛出的异常，主要分为两种情况：StackOverflowError 和 OutOfMemoryError，其触发条件和场景不同。 一、StackOverflowError（栈溢出错误） 当单个线程的虚拟机栈深度超过其最大限制时抛出，是最常见的栈内存溢出类型。 触发条件 无限递归或递归层级..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-12-23T09:23:42.000Z"}],["meta",{"property":"article:tag","content":"JVM"}],["meta",{"property":"article:tag","content":"面试题"}],["meta",{"property":"article:modified_time","content":"2025-12-23T09:23:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"什么情况下会发生栈内存溢出\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-23T09:23:42.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":2.46,"words":737},"git":{"updatedTime":1766481822000,"contributors":[{"name":"hubao-1125","username":"hubao-1125","email":"19473254+hubao-1125@users.noreply.github.com","commits":1,"avatar":"https://avatars.githubusercontent.com/hubao-1125?v=4","url":"https://github.com/hubao-1125"}]},"autoDesc":true,"filePathRelative":"doc/Java/JVM/分代分区/11.什么情况下会发生栈内存溢出.md","categoryList":[{"id":"9a09b4","sort":10000,"name":"doc"},{"id":"8f1aa6","sort":10001,"name":"Java"},{"id":"000f90","sort":10002,"name":"JVM"},{"id":"2b6b47","sort":10003,"name":"分代分区"}]}`);export{r as comp,i as data};
